<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>GitHub Assist: ZIP to EXE Converter</title>
    <style>
        body { font-family: sans-serif; text-align: center; padding: 50px; background: #f4f4f9; }
        .drop-zone { border: 2px dashed #007bff; padding: 40px; border-radius: 10px; background: white; cursor: pointer; }
        #status { margin-top: 20px; font-weight: bold; color: #333; }
        button { margin-top: 20px; padding: 10px 20px; background: #28a745; color: white; border: none; border-radius: 5px; cursor: pointer; display: none; }
    </style>
</head>
<body>

    <h1>ğŸ“¦ ZIP to EXE Converter</h1>
    <p>ãƒã‚¸ãƒƒã‚¯ãƒŠãƒ³ãƒãƒ¼ã‚’å¤‰æ›ã—ã€ç‹¬è‡ªã‚·ã‚°ãƒãƒãƒ£ã‚’ä»˜ä¸ã—ãŸEXEã‚’ç”Ÿæˆã—ã¾ã™ã€‚</p>

    <div id="dropZone" class="drop-zone">
        ZIPãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã“ã“ã«ãƒ‰ãƒ­ãƒƒãƒ—ã€ã¾ãŸã¯ã‚¯ãƒªãƒƒã‚¯ã—ã¦é¸æŠ
    </div>
    <input type="file" id="fileInput" accept=".zip" style="display: none;">

    <div id="status"></div>
    <button id="downloadBtn">EXEã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>

    <script>
        const dropZone = document.getElementById('dropZone');
        const fileInput = document.getElementById('fileInput');
        const status = document.getElementById('status');
        const downloadBtn = document.getElementById('downloadBtn');

        let generatedBlob = null;

        // 1. é››å½¢ã¨ãªã‚‹ã‚¹ã‚¿ãƒ–EXEï¼ˆä¸­èº«ã‚’èª­ã¿å–ã£ã¦å®Ÿè¡Œã™ã‚‹ã‚¨ãƒ³ã‚¸ãƒ³ï¼‰
        // æœ¬æ¥ã¯äº‹å‰ã«ãƒ“ãƒ«ãƒ‰ã—ãŸãƒã‚¤ãƒŠãƒªã‚’Base64ãªã©ã§åŸ‹ã‚è¾¼ã‚€å¿…è¦ãŒã‚ã‚Šã¾ã™
        const STUB_BASE64 = "TVqQAAMAAAAEAAAA//8AALgAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAA..."; // ã“ã“ã«ã‚¹ã‚¿ãƒ–ã®ãƒã‚¤ãƒŠãƒªã‚’å…¥ã‚Œã‚‹

        dropZone.onclick = () => fileInput.click();

        fileInput.onchange = (e) => handleFile(e.target.files[0]);

        async function handleFile(file) {
            if (!file) return;
            status.innerText = "å¤‰æ›ä¸­...";

            const zipArrayBuffer = await file.arrayBuffer();
            const zipBytes = new Uint8Array(zipArrayBuffer);

            // 2. ãƒã‚¸ãƒƒã‚¯ãƒŠãƒ³ãƒãƒ¼ã®å¤‰æ›ï¼ˆXORæ¼”ç®—ã§ PK ã‚·ã‚°ãƒãƒãƒ£ã‚’éš è”½ï¼‰
            // ZIPã®å…ˆé ­ 50 4B 03 04 ã‚’æ›¸ãæ›ãˆã‚‹
            const xorKey = 0x42; // ä»»æ„ã®ã‚­ãƒ¼
            const transformedZip = zipBytes.map(byte => byte ^ xorKey);

            // 3. ã‚¹ã‚¿ãƒ–EXEã¨çµåˆ
            // ç‹¬è‡ªã®ã‚·ã‚°ãƒãƒãƒ£ 'GHA' (GitHub Assist) ã‚’å¢ƒç•Œç·šã«ã™ã‚‹
            const signature = new TextEncoder().encode("GHA_SIG");
            const stubBytes = new Uint8Array(atob(STUB_BASE64).split("").map(c => c.charCodeAt(0)));
            
            const finalExe = new Uint8Array(stubBytes.length + signature.length + transformedZip.length);
            finalExe.set(stubBytes);
            finalExe.set(signature, stubBytes.length);
            finalExe.set(transformedZip, stubBytes.length + signature.length);

            generatedBlob = new Blob([finalExe], { type: 'application/octet-stream' });
            
            status.innerText = "å¤‰æ›å®Œäº†ï¼ãƒã‚¸ãƒƒã‚¯ãƒŠãƒ³ãƒãƒ¼ã‚’éš è”½ã—ã¾ã—ãŸã€‚";
            downloadBtn.style.display = 'inline-block';
        }

        downloadBtn.onclick = () => {
            const a = document.createElement('a');
            a.href = URL.createObjectURL(generatedBlob);
            a.download = "converted_app.exe";
            a.click();
        };
    </script>
</body>
</html>
